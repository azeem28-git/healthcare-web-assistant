<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Signup - HealthCare Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary-color:#0d6efd; }
        body { background:#f8f9fa; min-height:100vh; display:flex; align-items:center; justify-content:center; }
        .signup-card { width:100%; max-width:520px; background:#fff; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
        .signup-card .card-header { background:linear-gradient(135deg, var(--primary-color), #5a9bfd); color:#fff; border-radius:12px 12px 0 0; }
        .form-text.small { font-size:.85rem; }
    </style>
</head>
<body>
    <div class="signup-card card border-0">
        <div class="card-header p-4">
            <h3 class="mb-0"><i class="fa-solid fa-user-plus me-2"></i>Create Admin Account</h3>
            <p class="mb-0 opacity-75">Manage your healthcare portal securely</p>
        </div>
        <div class="card-body p-4">
            <form id="signupForm" novalidate>
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label" for="fullName">Full Name</label>
                        <input class="form-control" id="fullName" type="text" required />
                    </div>
                    <div class="col-12">
                        <label class="form-label" for="email">Email</label>
                        <input class="form-control" id="email" type="email" required />
                        <div class="form-text small">We'll never share your email.</div>
                    </div>
                    <div class="col-12">
                        <label class="form-label" for="username">Username</label>
                        <input class="form-control" id="username" type="text" minlength="4" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="password">Password</label>
                        <input class="form-control" id="password" type="password" minlength="6" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="confirmPassword">Confirm Password</label>
                        <input class="form-control" id="confirmPassword" type="password" minlength="6" required />
                    </div>
                    <div class="col-12 d-flex align-items-center gap-2">
                        <input class="form-check-input" type="checkbox" id="terms" required />
                        <label class="form-check-label" for="terms">I agree to the Terms & Privacy</label>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary w-100" type="submit">
                            <i class="fa-solid fa-user-check me-2"></i>Create Account
                        </button>
                    </div>
                </div>
            </form>
            <div class="text-center mt-3">
                <a href="login.html">Already have an account? Sign in</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function resolveApiBase() {
            const cached = localStorage.getItem('api_base');
            if (cached) return cached;
            const ports = [3000, 3001, 3002];
            for (const p of ports) {
                try {
                    const ctrl = new AbortController();
                    const t = setTimeout(() => ctrl.abort(), 1200);
                    const res = await fetch(`http://localhost:${p}/api/health`, { signal: ctrl.signal });
                    clearTimeout(t);
                    if (res.ok) {
                        const base = `http://localhost:${p}`;
                        localStorage.setItem('api_base', base);
                        return base;
                    }
                } catch (e) { /* try next */ }
            }
            throw new Error('API not reachable');
        }
        document.getElementById('signupForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim().toLowerCase();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const terms = document.getElementById('terms').checked;

            if (!terms) return alert('Please accept the Terms & Privacy policy.');
            if (password !== confirmPassword) return alert('Passwords do not match.');

            try {
                const API_BASE = await resolveApiBase();
                const res = await fetch(`${API_BASE}/api/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fullName, email, username, password })
                });
                const data = await res.json().catch(()=>({message:'Signup failed'}));
                if (!res.ok) {
                    return alert(data.message || 'Signup failed');
                }
                sessionStorage.setItem('signup_success', '1');
                window.location.href = 'login.html';
            } catch (err) {
                alert('Network error. Ensure backend is running on http://localhost:3000');
            }
        });
    </script>
</body>
</html>
